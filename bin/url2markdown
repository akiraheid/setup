#!/usr/bin/env bash
#
# Convert a web page to Markdown

set -e

if [[ ! $# == 1 ]]; then
	echo "Expected URL"
	exit 1
fi

URL=$1
TMP_NAME=$(mktemp)
chmod 774 "${TMP_NAME}"
curl -o "${TMP_NAME}" --silent "${URL}"

DOMAIN=$(echo "$URL" | cut -d '/' -f 3)
MD_NAME=${DOMAIN}.md
touch "${MD_NAME}"
html2markdown --domain "${DOMAIN}" \
	--plugin-strikethrough \
	--plugin-table \
		--opt-table-header-promotion \
		--opt-table-newline-behavior=preserve \
		--opt-strong-delimiter="**" \
	--input "${TMP_NAME}" > "${MD_NAME}"

pymarkdownlnt fix "${MD_NAME}" 2>/dev/null

rm "${TMP_NAME}"
